# @configure_input@
#  Main Makefile for GNUstep Base Library.
#  
#  Copyright (C) 1993,1994,1995, 1996 Free Software Foundation, Inc.
#
#  Written by:	Andrew Kachites McCallum <mccallum@gnu.ai.mit.edu>
#
#  This file is part of the GNUstep Base Library.
#
#  This library is free software; you can redistribute it and/or
#  modify it under the terms of the GNU Library General Public
#  License as published by the Free Software Foundation; either
#  version 2 of the License, or (at your option) any later version.
#
#  This library is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	 See the GNU
#  Library General Public License for more details.
#
#  You should have received a copy of the GNU Library General Public
#  License along with this library; if not, write to the Free
#  Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 

SHELL = /bin/sh

#### Start of system configuration section. ####

srcdir = @srcdir@
VPATH = @srcdir@

MAKEDEFINES =

#### End of system configuration section. ####

include $(srcdir)/Makeconf
include $(srcdir)/Version

SUBDIRS = src doc checks examples NSCharacterSets admin

RCS_FILES = \
	Makefile.in Makeconf configure.in aclocal.m4 \
	configure.bat Makefile.sed.nt INSTALL.WIN32 \
	config/config.nested.c config/config.nextcc.h config/config.nextrt.m 

DIST_FILES = \
	$(RCS_FILES) \
	README.ULTRIX README.foundation README.ucblib \
	STATUS RELEASE-NOTES \
	COPYING COPYING.LIB ChangeLog \
	configure Version \
	config.guess mkinstalldirs install-sh \
	NSBundle.README \
	gcc-2.7.2-objc.diff
	gcc-2.7.2.1-objc.diff

all: src

%-subdirs:
	for i in $(SUBDIRS); do \
	  (cd $$i; $(MAKE) $(MAKEDEFINES) $*); \
	done

src doc checks examples: FORCE
	cd $@; $(MAKE) $(MAKEDEFINES)

install uninstall TAGS:
	for i in $(SUBDIRS); do \
	  (cd $$i; $(MAKE) $(MAKEDEFINES) $@); \
	done

info dvi:
	cd doc; $(MAKE) $(MAKEDEFINES) $@

check: 
	cd checks; $(MAKE) $(MAKEDEFINES)

Makefile: Makefile.in config.status
	$(SHELL) config.status
config.status: configure
	$(SHELL) $(srcdir)/configure --no-create
configure: configure.in
	cd $(srcdir); autoconf

mostlyclean-top:
	rm -f *~
clean-top:
distclean-top:
	rm -f Makefile config.status config.log config.cache TAGS
maintainer-clean-top:

mostlyclean: mostlyclean-top mostlyclean-subdirs
clean: clean-top clean-subdirs
distclean: distclean-top distclean-subdirs
maintainer-clean: maintainer-clean-top maintainer-clean-subdirs

snap: $(DIST_FILES)
	rm -rf snap
	mkdir snap
	for i in $(SUBDIRS); do \
	  (cd $$i; $(MAKE) $(MAKEDEFINES) copy-dist); \
	done
	mkdir snap/config
	for file in $(DIST_FILES); do \
	  ln $$file snap/$$file ; \
	done

snapshot: snap
	ln README.first snap
	rm -f .name
	echo $(PACKAGE_NAME)-`date +%y%m%d` >.name
	rm -rf `cat .name`
	mv snap `cat .name`
	tar -chvf `cat .name`.tar `cat .name`
	rm -f `cat .name`.tar.gz
	gzip -9 `cat .name`.tar
	rm -rf `cat .name`

dist: snap
	mv snap $(PACKAGE_NAME)-$(VERSION)
	tar -chvf $(PACKAGE_NAME)-$(VERSION).tar \
		$(PACKAGE_NAME)-$(VERSION)
	rm -f $(PACKAGE_NAME)-$(VERSION).tar.gz
	gzip -9 $(PACKAGE_NAME)-$(VERSION).tar
	rm -rf $(PACKAGE_NAME)-$(VERSION)

snapshot-rtag:
	cvs rtag snapshot-`date +%y%m%d` $(PACKAGE_NAME)

dist-rtag:
	cvs rtag release-`echo $(VERSION) | tr . -` $(PACKAGE_NAME)

rdiff:
	cvs rdiff -u -r $(OLD) $(PACKAGE_NAME)

FORCE:
