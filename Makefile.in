# @configure_input@
#
#  Main makefile for GNU Objective-C Class library
#  Copyright (C) 1993,1994,1995 Free Software Foundation, Inc.
#
#  Written by:	R. Andrew McCallum <mccallum@gnu.ai.mit.edu>
#
#  This file is part of the GNU Objective-C Class library.
#
#  This library is free software; you can redistribute it and/or
#  modify it under the terms of the GNU Library General Public
#  License as published by the Free Software Foundation; either
#  version 2 of the License, or (at your option) any later version.
#
#  This library is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	 See the GNU
#  Library General Public License for more details.
#
#  You should have received a copy of the GNU Library General Public
#  License along with this library; if not, write to the Free
#  Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 

SHELL = /bin/sh

#### Start of system configuration section. ####

srcdir = @srcdir@
VPATH = @srcdir@

MAKEDEFINES =

#### End of system configuration section. ####

include $(srcdir)/Version

SUBDIRS = src doc checks examples NSCharacterSets admin

RCS_FILES = \
	CREDITS MACHINES \
	Makefile.in Makeconf configure.in \
	config/config.nested.c config/config.nextcc.h config/config.nextrt.m 

DIST_FILES = \
	$(RCS_FILES) \
	README.ULTRIX GNUStep-volunteers \
	COPYING COPYING.LIB DISCUSSION ChangeLog \
	configure Version \
	config.guess mkinstalldirs install-sh \
	NSBundle.README 

all: src

%-subdirs:
	for i in $(SUBDIRS); do \
	  (cd $$i; $(MAKE) -$(MAKEFLAGS) $(MAKEDEFINES) $*); \
	done

src doc checks examples: FORCE
	cd $@; $(MAKE) -$(MAKEFLAGS) $(MAKEDEFINES)

install uninstall TAGS:
	for i in $(SUBDIRS); do \
	  (cd $$i; $(MAKE) -$(MAKEFLAGS) $(MAKEDEFINES) $@); \
	done

info dvi:
	cd doc; $(MAKE) -$(MAKEFLAGS) $(MAKEDEFINES) $@

check: libobjects.a
	cd checks; $(MAKE) -$(MAKEFLAGS) $(MAKEDEFINES)

Makefile: Makefile.in config.status
	$(SHELL) config.status
config.status: configure
	$(SHELL) $(srcdir)/configure --no-create
configure: configure.in
	cd $(srcdir); autoconf

mostlyclean-top:
	rm -f *~
clean-top:
distclean-top:
	rm -f Makefile config.status config.log config.cache TAGS
maintainer-clean-top:

mostlyclean: mostlyclean-top mostlyclean-subdirs
clean: mostlyclean-top clean-subdirs
distclean: clean-top distclean-subdirs
maintainer-clean: distclean-top maintainer-clean-subdirs

dist: $(DIST_FILES)
	rm -rf snap
	mkdir snap
	# beginning of top-level copy-dist section
	for i in $(SUBDIRS); do \
	  (cd $$i; $(MAKE) -$(MAKEFLAGS) $(MAKEDEFINES) copy-dist); \
	done
	mkdir snap/config
	for file in $(DIST_FILES); do \
	  ln $$file snap/$$file ; \
	done
	# end of top-level copy-dist section
	mv snap libobjects-$(OBJECTS_VERSION)
	tar -chvf libobjects-$(OBJECTS_VERSION).tar \
		libobjects-$(OBJECTS_VERSION)
	gzip libobjects-$(OBJECTS_VERSION).tar
	rm -rf libobjects-$(OBJECTS_VERSION)

rcs-list-locked: 
	@echo "===."
	@rlog -L -R $(RCS_FILES)
	@for i in $(SUBDIRS); do \
	  echo "===$$i"; \
	  (cd $$i; \
	   $(MAKE) -s -$(MAKEFLAGS) $(MAKEDEFINES) rcs-list-locked); \
	done

FORCE:
