#!/usr/grads/bin/bash

PATH=/u/mccallum/sparc/bin:/usr/grads/bin:/usr/staff/bin:$PATH
snapdate=`date +%y%m%d`

# Make the snapshot
cd /u/mccallum/collection/libobjects
rm -f .snapshot.errs
make snapshot &> .snapshot.errs

# Move it to ftp location
if [ -e libobjects-${snapdate}.tar.gz ]; then
 rm -f /home/cayuga/ftp/pub/u/mccallum/libobjects/libobjects-9*
 rm -f /home/cayuga/ftp/pub/u/mccallum/libobjects/ChangeLog-9*
 mv libobjects-${snapdate}.tar.gz \
   /home/cayuga/ftp/pub/u/mccallum/libobjects
 cp ChangeLog \
   /home/cayuga/ftp/pub/u/mccallum/libobjects/ChangeLog-${snapdate}
 gzip -9 /home/cayuga/ftp/pub/u/mccallum/libobjects/ChangeLog-${snapdate}
 cp ChangeLog \
   /home/cayuga/ftp/pub/u/mccallum/libobjects/ChangeLog-${snapdate}
 chmod a+r /home/cayuga/ftp/pub/u/mccallum/libobjects/*
fi

# Send me mail about it
rm -f .snapshot.mail
echo "This automatically generated by libobjects/cronscript" >.snapshot.mail
echo >>.snapshot.mail
ls -l /home/cayuga/ftp/pub/u/mccallum/libobjects/* >>.snapshot.mail
echo >>.snapshot.mail
cat .snapshot.errs >>.snapshot.mail
mail -s "libobjects-${snapdate} snapshot" mccallum < .snapshot.mail
